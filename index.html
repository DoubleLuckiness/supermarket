<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…å¸‚ç®¡ç†ç³»ç»Ÿ - LeanCloud æµ‹è¯•</title>
    <!-- ä½¿ç”¨å¯é çš„ CDN -->
    <script src="js/av-min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .config-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #3498db;
        }
        
        .config-box h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .config-box h3::before {
            content: "âš™ï¸";
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #95a5a6;
        }
        
        .status-dot.connected { background: #2ecc71; animation: pulse 2s infinite; }
        .status-dot.disconnected { background: #e74c3c; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin: 25px 0;
        }
        
        button {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            flex: 2;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-secondary {
            background: #ecf0f1;
            color: #2c3e50;
            flex: 1;
        }
        
        .btn-secondary:hover {
            background: #d5dbdb;
        }
        
        .result-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            min-height: 200px;
            display: none;
        }
        
        .result-box.active {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .success-msg {
            color: #27ae60;
            padding: 15px;
            background: #d5f4e6;
            border-radius: 8px;
            border-left: 4px solid #27ae60;
            margin: 15px 0;
        }
        
        .error-msg {
            color: #e74c3c;
            padding: 15px;
            background: #fadbd8;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
            margin: 15px 0;
        }
        
        .loading {
            color: #3498db;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .test-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .domain-info {
            background: #fff8e1;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ffb300;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 15px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸª è¶…å¸‚ç®¡ç†ç³»ç»Ÿ</h1>
        <p class="subtitle">LeanCloud åç«¯æœåŠ¡è¿æ¥æµ‹è¯•</p>
    </div>
    
    <div class="config-box">
        <h3>é…ç½®ä¿¡æ¯</h3>
        <div class="status-indicator">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">ç­‰å¾…è¿æ¥æµ‹è¯•</span>
        </div>
        
        <div class="domain-info">
            <strong>ğŸŒ å½“å‰åŸŸåï¼š</strong>
            <code id="currentDomain"></code>
            <p style="margin-top: 10px; font-size: 0.9em;">
                ç¡®ä¿å·²åœ¨ LeanCloud æ§åˆ¶å°çš„ <strong>Web å®‰å…¨åŸŸå</strong> ä¸­æ·»åŠ æ­¤åŸŸå
            </p>
        </div>
        
        <div class="btn-group">
            <button class="btn-primary" onclick="testConnection()">
                <span>ğŸ”— æµ‹è¯•è¿æ¥</span>
            </button>
            <button class="btn-secondary" onclick="resetTest()">
                <span>ğŸ”„ é‡ç½®</span>
            </button>
        </div>
    </div>
    
    <div class="result-box" id="resultBox">
        <!-- ç»“æœä¼šåŠ¨æ€æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
    </div>
    
    <div class="footer">
        <p>å‰ç«¯éƒ¨ç½²åœ¨ï¼šhttps://doubleluckiness.github.io/supermarket/</p>
        <p>å¦‚æœè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ LeanCloud Web å®‰å…¨åŸŸåé…ç½®</p>
    </div>

    <script>
        // ==================== é…ç½®åŒºåŸŸ ====================
        // åœ¨è¿™é‡Œå¡«å†™ä½ çš„ LeanCloud é…ç½®ï¼ˆä»æ§åˆ¶å°å¤åˆ¶ï¼‰
        const LEANCLOUD_CONFIG = {
            appId: 'AwXkql18rsZZ276uJtabPPUQ-gzGzoHsz',      // æ›¿æ¢ä¸ºä½ çš„ App ID
            appKey: '6dYgDhh7r1ZQXx1dxwW1wc0L',       // æ›¿æ¢ä¸ºä½ çš„ App Key
            serverURL: 'https://awxkql18.lc-cn-n1-shared.com'  // æ›¿æ¢ä¸ºä½ çš„ API åœ°å€
        };
        // ==================== é…ç½®ç»“æŸ ====================
        
        // æ˜¾ç¤ºå½“å‰åŸŸå
        document.getElementById('currentDomain').textContent = window.location.origin;
        
        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateStatus(text, type) {
            const dot = document.getElementById('statusDot');
            const textEl = document.getElementById('statusText');
            
            textEl.textContent = text;
            dot.className = 'status-dot';
            
            if (type === 'success') {
                dot.classList.add('connected');
            } else if (type === 'error') {
                dot.classList.add('disconnected');
            }
        }
        
        // æµ‹è¯•è¿æ¥
        async function testConnection() {
            const resultBox = document.getElementById('resultBox');
            resultBox.className = 'result-box active';
            
            // ç¬¬ä¸€æ­¥ï¼šæ˜¾ç¤ºåŠ è½½çŠ¶æ€
            resultBox.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åˆå§‹åŒ– LeanCloud è¿æ¥...</p>
                </div>
            `;
            
            updateStatus('æ­£åœ¨è¿æ¥...', 'loading');
            
            try {
                // æ£€æŸ¥ SDK æ˜¯å¦åŠ è½½
                if (typeof AV === 'undefined') {
                    throw new Error('LeanCloud SDK æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–CDN');
                }
                
                // åˆå§‹åŒ– AV
                AV.init({
                    appId: LEANCLOUD_CONFIG.appId,
                    appKey: LEANCLOUD_CONFIG.appKey,
                    serverURLs: LEANCLOUD_CONFIG.serverURL
                });
                
                resultBox.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>SDK åˆå§‹åŒ–æˆåŠŸï¼Œæ­£åœ¨æµ‹è¯•æ•°æ®å­˜å‚¨...</p>
                    </div>
                `;
                
                // åˆ›å»ºæµ‹è¯•ç±»ï¼ˆä½¿ç”¨å”¯ä¸€åç§°ï¼‰
                const className = 'TestConnection_' + Date.now();
                const TestClass = AV.Object.extend(className);
                
                // åˆ›å»ºæµ‹è¯•æ•°æ®
                const testData = {
                    appName: 'è¶…å¸‚ç®¡ç†ç³»ç»Ÿ',
                    testTime: new Date(),
                    testField: 'GitHub Pages è¿æ¥æµ‹è¯•',
                    environment: 'production',
                    domain: window.location.origin
                };
                
                const testObj = new TestClass();
                Object.keys(testData).forEach(key => {
                    testObj.set(key, testData[key]);
                });
                
                // ä¿å­˜åˆ° LeanCloud
                const savedObj = await testObj.save();
                
                // æŸ¥è¯¢éªŒè¯
                const query = new AV.Query(className);
                query.equalTo('objectId', savedObj.id);
                const retrievedObj = await query.first();
                
                // æ˜¾ç¤ºæˆåŠŸç»“æœ
                resultBox.innerHTML = `
                    <div class="success-msg">
                        <h3>ğŸ‰ è¿æ¥æµ‹è¯•æˆåŠŸï¼</h3>
                        <p>ä½ çš„å‰ç«¯å·²æˆåŠŸè¿æ¥åˆ° LeanCloud åç«¯æœåŠ¡</p>
                    </div>
                    
                    <div class="test-details">
                        <p><strong>ğŸ“‹ æµ‹è¯•è¯¦æƒ…ï¼š</strong></p>
                        <p>ğŸ“Œ æµ‹è¯•å¯¹è±¡IDï¼š${savedObj.id}</p>
                        <p>ğŸ“Œ åº”ç”¨åç§°ï¼š${retrievedObj.get('appName')}</p>
                        <p>ğŸ“Œ æµ‹è¯•æ—¶é—´ï¼š${new Date(retrievedObj.get('testTime')).toLocaleString()}</p>
                        <p>ğŸ“Œ æµ‹è¯•å­—æ®µï¼š${retrievedObj.get('testField')}</p>
                        <p>ğŸ“Œ è¿è¡Œç¯å¢ƒï¼š${retrievedObj.get('environment')}</p>
                        <p>ğŸ“Œ å½“å‰åŸŸåï¼š${retrievedObj.get('domain')}</p>
                        <p>ğŸ“Œ åˆ›å»ºæ—¶é—´ï¼š${new Date(retrievedObj.createdAt).toLocaleString()}</p>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                        <p><strong>âœ… é…ç½®éªŒè¯é€šè¿‡ï¼š</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>App ID é…ç½®æ­£ç¡®</li>
                            <li>App Key é…ç½®æ­£ç¡®</li>
                            <li>Server URL é…ç½®æ­£ç¡®</li>
                            <li>Web å®‰å…¨åŸŸåé…ç½®æ­£ç¡®</li>
                            <li>ç½‘ç»œè¿æ¥æ­£å¸¸</li>
                        </ul>
                    </div>
                `;
                
                updateStatus('è¿æ¥æˆåŠŸ', 'success');
                
                // æ¸…ç†æµ‹è¯•æ•°æ®ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼‰
                setTimeout(async () => {
                    try {
                        await savedObj.destroy();
                        console.log('ğŸ§¹ æµ‹è¯•æ•°æ®å·²æ¸…ç†');
                    } catch (e) {
                        console.warn('æ¸…ç†æ•°æ®å¤±è´¥:', e);
                    }
                }, 3000);
                
            } catch (error) {
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                resultBox.innerHTML = `
                    <div class="error-msg">
                        <h3>âŒ è¿æ¥æµ‹è¯•å¤±è´¥</h3>
                        <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>${error.message}</p>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 20px; background: #ffebee; border-radius: 8px;">
                        <h4>ğŸ”§ æ•…éšœæ’é™¤æ­¥éª¤ï¼š</h4>
                        <ol style="margin-top: 10px; padding-left: 20px;">
                            <li><strong>æ£€æŸ¥ Web å®‰å…¨åŸŸåï¼š</strong>
                                <p>ç™»å½• LeanCloud æ§åˆ¶å° â†’ è®¾ç½® â†’ å®‰å…¨ä¸­å¿ƒ â†’ Web å®‰å…¨åŸŸå</p>
                                <p>æ·»åŠ ï¼š<code>https://doubleluckiness.github.io</code></p>
                            </li>
                            <li><strong>æ£€æŸ¥ App ID å’Œ Keyï¼š</strong>
                                <p>ç¡®è®¤é…ç½®ä¸­çš„ App ID å’Œ App Key æ˜¯å¦æ­£ç¡®</p>
                            </li>
                            <li><strong>æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼š</strong>
                                <p>ç¡®ä¿å¯ä»¥è®¿é—® LeanCloud API åœ°å€</p>
                            </li>
                            <li><strong>æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ï¼š</strong>
                                <p>æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹ Console å’Œ Network æ ‡ç­¾é¡µ</p>
                            </li>
                        </ol>
                    </div>
                    
                    <div class="test-details" style="margin-top: 20px;">
                        <p><strong>ğŸ“Š è°ƒè¯•ä¿¡æ¯ï¼š</strong></p>
                        <p>å½“å‰åŸŸåï¼š${window.location.origin}</p>
                        <p>é”™è¯¯ä»£ç ï¼š${error.code || 'æ— '}</p>
                        <p>é”™è¯¯è¯¦æƒ…ï¼š${JSON.stringify(error, null, 2)}</p>
                    </div>
                `;
                
                updateStatus('è¿æ¥å¤±è´¥', 'error');
                console.error('è¿æ¥å¤±è´¥è¯¦æƒ…:', error);
            }
        }
        
        // é‡ç½®æµ‹è¯•
        function resetTest() {
            const resultBox = document.getElementById('resultBox');
            resultBox.className = 'result-box';
            resultBox.innerHTML = '';
            updateStatus('ç­‰å¾…è¿æ¥æµ‹è¯•', '');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸª è¶…å¸‚ç®¡ç†ç³»ç»Ÿ - LeanCloud æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸŒ å½“å‰åŸŸå:', window.location.origin);
            console.log('ğŸ”§ è¯·ç¡®ä¿åœ¨ LeanCloud ä¸­æ·»åŠ  Web å®‰å…¨åŸŸå:', window.location.origin);
        });
    </script>
</body>
</html>